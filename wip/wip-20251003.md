# WIP - 2025/10/03 進度報告

## 今日完成項目

### 1. Docker 環境問題診斷與解決
- **問題**：PostgreSQL 連接錯誤 `FATAL: role "-d" does not exist`
- **根因分析**：缺少 `backend/.env` 檔案，導致 Docker Compose 環境變數無法解析
- **學習重點**：
  - Docker Compose 層級變數 (`${VAR}`) vs Container 層級變數 (`$${VAR}`)
  - 環境變數的來源和解析順序
  - Health check 如何讀取 container 環境變數

### 2. Docker 資源清理
- 清除所有專案相關的 Docker 資源：
  - Containers: `threads-dev-*` 系列
  - Volumes: `postgres_data`, `redis_data`
  - Images: PostgreSQL, Redis, 自建 images
  - Networks: `threads-dev_default`
- **釋放空間**：171.4MB

### 3. 環境變數使用方式總結
- 建立完整的 Docker Compose 環境變數使用指南
- 釐清變數來源層級和解析順序
- 識別專案中需要的環境檔案結構

## 技術學習收穫

### Docker Compose 環境變數機制
1. **Docker Compose 層級**：從同層 `.env` 讀取 `${VAR}`
2. **Container 層級**：使用 `$${VAR}` 讀取 container 環境變數
3. **Application 層級**：透過 `env_file` 指定路徑讀取

### 專案環境檔案需求
- `backend/.env` - Docker Compose 層級變數
- `backend/conf/dev/.env` - Dev 環境 Application 變數
- `backend/conf/prod/.env` - Prod 環境 Application 變數

## 下次目標進度

### 主要任務：修復 CI/CD 需要使用到的 docker-compose yml 檔案

#### 具體目標：
1. **建立缺失的環境檔案**
   - 創建 `backend/.env` 檔案
   - 創建 `backend/conf/dev/.env` 檔案
   - 創建 `backend/conf/prod/.env` 檔案

2. **驗證 Docker Compose 配置**
   - 測試 `docker-compose-local-dev.yml` 正常啟動
   - 測試 `docker-compose-local-prod.yml` 正常啟動
   - 確認所有服務健康檢查通過

3. **CI/CD 相關檔案檢查**
   - 檢查 GitHub Actions workflow 檔案
   - 確認 CI/CD 流程中使用的 docker-compose 檔案
   - 修復任何配置問題

4. **文檔更新**
   - 更新 Docker 環境變數使用指南
   - 建立環境設定步驟說明

#### 預期成果：
- 所有 Docker Compose 檔案可以正常運行
- CI/CD 流程可以順利執行
- 團隊成員可以快速設定開發環境

## 備註
- 當前專案使用 Docker Compose v2 (`docker compose` 而非 `docker-compose`)
- 需要確保所有環境變數都正確定義，避免類似 `role "-d" does not exist` 的錯誤

